# 第2章 8086微机系统

## 2.1 概述
以微机为主体，配上软件和外部设备（简称外设）之后，就构成了微机系统。

### 2.1.1 微机系统的工作原理
微机系统的整个工作过程就是不断取指令和执行指令的过程，其基本工作原理是存储程序和程序控制。

### 2.1.2 微机系统的硬件组成
冯.诺依漫结构-存储程序和程序控制，微机系统硬件由运算器、控制器、存储器、输入设备和输出设备
![](../../attachments/Pasted%20image%2020241007111317.png)
更加细分的结构图如下：
![|500](../../attachments/Pasted%20image%2020241007111431.png)

1. 微处理器
   微处理器包含运算器和控制器微处理器的性能基本决定了计算机的性能，是微机的核心。
2. 协处理器
   协处理器用于特定任务的处理，以减轻系统微处理器的负担，是微机系统的选配硬件。
3. 内存储器（也称主存或内存）
   内存储器用于存放计算机正在运行的程序和用到的数据等，分为随机存储器（RAM）和只读存储器（ROM）两大类。
4. 总线控制逻辑
   微机系统采用总线结构，总线是连接计算机各个组成部件的公共数据通路。在微机系统中，总线分片内总线，片级总线和系统总线。
   片内总线用于**连接微处理器内部的各个部件。**
   片级总线用于连接微处理器、存储器以及I/O接口等，**构成所谓的主板。**
   **系统总线连接外设**，也就是主板上的扩充插槽。主板与外设之间数据传输必须通过系统总线，所以系统总线包含的信号线必须满足下列各种输入/输出的操作的需要：访问分布于主板之外的存储器、访问I/O 接口、适应外部中断方式、适应存储器直接与外设交换信息。**总线控制逻辑的任务就是产生和接收这些操作所需要的信号**
5. 外存储器（辅存或者外存）
   用来存储大量暂时不参加运算或处理的数据和程序，是主存的后备和补充。

## 2.2 8086微处理器的结构
8086是intel系列的16位微处理器，采用hmos工艺制造，有16根数据线和20位地址线，采用40脚双列直插式封装。可寻的内存空间是$2^{20}B$ ,即1MB; I/O 的地址空间为$2^{16}B$，即64kb。

### 2.2.1 8086的内部结构
8086的内部结构由执行部件（Execution Unit，EU ）和总线接口部件（Bus Interface， BIU）两部分组成，这两个部分可以并行工作。如下图：
![](../../attachments/Pasted%20image%2020241007114518.png)
**这个图很重要，要求能够画出来。**

1. 执行部件（EU）
   EU由算术逻辑单元（ALU）、8个通用寄存器、标志寄存器和控制电路组成。ALU可完成8位数或16位数的算术或者逻辑运算。
   EU负责指令的执行，即从总线接口部件（BIU）的指令队列取指令，指令执行后向BIU送回运算结果，同时把运算结果的状态保存刀标志寄存器中。
   EU不直接与外部系统相连。当需要与主存储器或外设交换数据时，EU向BIU发出命令，并向BIU提供16位的有效地址及所需要传送的数据。
2. 总线接口部件（BIU）
   BIU由寄存器，指令寄存器（IP），地址加法器，内部暂存器，指令队列缓冲和总线控制逻辑组成，负责CPU与存储器，外设之间的数据传送。
   BIU 完成以下操作：取指令送给指令队列->配合执行部件从指定的内存单元或I/O接口中取数据->将数据传送给执行部件或者把执行部件的操作结果传送到指定单元或者I/O接口中。
   - 地址加法器，8086有20位地址线，可以寻址1mb的内存空间，但8086内部所有的寄存器都是16位的，8086采用的存储器地址分段方法解决这个问题。
   - 段寄存器，8086有四个段地址寄存器，CS（代码段段寄存器），DS（数据段段寄存器）、SS（堆栈段段寄存器）、ES（附加段段寄存器）
   - 指令指针寄存器（IP），16位，保存下一条要取出的指令所在的的存储单元的偏移地址
   - 内部暂存器、暂存内部数据，对用户透明，用户编程时无权访问
   - 指令队列缓冲器、6字节，先进先出，EU执行完一条指令后可以取下一条指令，省去了cpu的等待时间
   - 总线控制逻辑，发出总线控制信号，实现存储器的读写控制以及I/O的读写控制。
3. BIU与EU的工作过程
   ![](../../attachments/Pasted%20image%2020241007144611.png)
### 2.2.2 8086的工作模式

1. 最小模式：单处理器模式，只有一片8086CPU，所连接存储容量不大，芯片不多，索要连接的外设也不多。这种情况下，系统控制总线可以直接由CPU的控制总线供给，使得系统的总线控制电路减到最小。最小模式适用于小规模系统。
2. 最大模式：可以有多个cpu，其中一个是主处理器8086，其他处理器称为协处理器，承担某方面专门的工作。

## 2.3 8086微处理器的引脚特性
![|306](../../attachments/Pasted%20image%2020241007145411.png)
引脚功能，信号有效电平、信号流向、引脚复用、三态能力

### 2.3.1 两种工作模式的公共引脚
- $MN/\overline{MX}$ (最大/最小模式选择线)：接5v电源最小模式，接低最大工作模式
- $AD_{15} \sim AD_{0}$ （数据/地址复用线，双向，三态）：分时复用总线，总线周期T1状态，作为低16位地址总线；总线周期T2，T3，Tw状态，数据总线。
- $A_{19}/S_{6}\sim A_{16}/S_{3}$（地址/状态复用线，输出，三态）：在总线周期T1状态作为最高4位地址线，（读写I/O这些不用，为低电平）；总线周期T2，T3，Tw，T4，这些引线作为状态信号线。$S_6$低电平表示8086与总线相连。$S_5$反应当前允许中断标志的状态，$S_4$和$S_3$一起只是当前哪段寄存器被使用。
  ![](../../attachments/Pasted%20image%2020241007151459.png)
- $\overline{BHE}/S_7$（数据总线高8位有效状态复用线，输出，三态）
  ![](../../attachments/Pasted%20image%2020241007151604.png)
- $\overline{RD}$ （输出，三态）
  ![](../../attachments/Pasted%20image%2020241007151654.png)
- $READY$（输入）
  ![](../../attachments/Pasted%20image%2020241007151840.png)
- $\overline{TEST}$（输入）：检测信号，低电平有效，他和WAIT指令配合使用。
  ![](../../attachments/Pasted%20image%2020241007152008.png)
- $INTER$（输入）
  ![](../../attachments/Pasted%20image%2020241007152704.png)
- $NMI$（输入）
  ![](../../attachments/Pasted%20image%2020241007152741.png)
- $RESET$（输入）
  ![](../../attachments/Pasted%20image%2020241007152813.png)
- $CLK$ （输入）：时钟信号，为cpu和控制总线提供基准时钟
- $V_{cc} \& GND$
  ![](../../attachments/Pasted%20image%2020241007153005.png)

### 2.3.2 最小模式的引脚
![](../../attachments/Pasted%20image%2020241007153059.png)

### 2.3.3 最大模式的引脚
![](../../attachments/Pasted%20image%2020241007153201.png)

## 2.4 8086 微机系统的总线时序
### 2.4.1 基本概念
微机系统的所有操作都按=统一的时钟节拍进行。CPU执行指令设计3种周期：时钟周期、总线周期、指令周期。
1. 时钟周期
   ![](../../attachments/Pasted%20image%2020241007154822.png)
2. 总线周期
   ![](../../attachments/Pasted%20image%2020241007154905.png)
   ![](../../attachments/Pasted%20image%2020241007154927.png)
   ![](../../attachments/Pasted%20image%2020241007154942.png)
3. 指令周期
   ![](../../attachments/Pasted%20image%2020241007155017.png)

总结：总线周期有一个或者多个时钟周期，指令周期有一个或者多个总线周期。

### 2.4.2 最小模式下的总线周期时序
1. 最小模式下的读周期时序
	![](../../attachments/Pasted%20image%2020241007160850.png)
	![](../../attachments/Pasted%20image%2020241007160925.png)
	![](../../attachments/Pasted%20image%2020241007160939.png)
1. 最小模式下的写周期时序
   ![](../../attachments/Pasted%20image%2020241007161058.png)
3. 8086的复位时序 
	![](../../attachments/Pasted%20image%2020241007161157.png)
4. 总线保持请求周期时序
   ![](../../attachments/Pasted%20image%2020241007161325.png)
   ![](../../attachments/Pasted%20image%2020241007161356.png)
   
### 2.4.3 最大模型下的总线周期时序
![](../../attachments/Pasted%20image%2020241007161445.png)
1. 最大模式下的读周期时序
   ![](../../attachments/Pasted%20image%2020241007161536.png)
   2. 最大模式下的写周期时序
      ![](../../attachments/Pasted%20image%2020241007161608.png)
  3. 最大模式下的总线请求/允许/释放操作
     ![](../../attachments/Pasted%20image%2020241007161707.png)
     ![](../../attachments/Pasted%20image%2020241007161729.png)

## 2.5 8086 微机系统硬件组成与组织

### 2.5.1 微机系统的硬件组成
1. 系统硬件组成的特点
   ![](../../attachments/Pasted%20image%2020241007163543.png)
2. 最小模式硬件组成
   ![](../../attachments/Pasted%20image%2020241007163704.png)
3. 最大模式硬件组成
   ![](../../attachments/Pasted%20image%2020241007163734.png)

### 2.5.2 8086微机系统的存储器组织
1. 存储器空间
   ![](../../attachments/Pasted%20image%2020241007164006.png)
2. 存储器分段管理（该部分有段地址，偏移地址，逻辑地址，物理地址定义）
   ![](../../attachments/Pasted%20image%2020241007164116.png)
   段地址：
   ![](../../attachments/Pasted%20image%2020241007164157.png)
   偏移地址：
   ![](../../attachments/Pasted%20image%2020241007164215.png)
   逻辑地址：
   ![](../../attachments/Pasted%20image%2020241007164236.png)
   物理地址：
   ![](../../attachments/Pasted%20image%2020241007164251.png)

### 2.5.3 8086微机系统的I/O组织
![](../../attachments/Pasted%20image%2020241007164437.png)

### 2.5.4 8086的寄存器结构
![](../../attachments/Pasted%20image%2020241007164546.png)
1. 数据寄存器
   ![](../../attachments/Pasted%20image%2020241007173144.png)
2. 指针和变址寄存器
   ![](../../attachments/Pasted%20image%2020241007173213.png)
3. 段寄存器
   ![](../../attachments/Pasted%20image%2020241007173235.png)
4. 指令指针寄存器
   ![](../../attachments/Pasted%20image%2020241007173308.png)
5. 标志寄存器
   ![](../../attachments/Pasted%20image%2020241007173342.png)
![](../../attachments/Pasted%20image%2020241007173356.png)
![](../../attachments/Pasted%20image%2020241007173411.png)
